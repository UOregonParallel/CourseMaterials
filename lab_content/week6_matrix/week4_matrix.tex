%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% File: Lecture_1.tex
% Authors: James Kress
% Date: February 1, 2014
% Description: 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<%
% Document package information
%>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>%
\documentclass[xcolor=dvipsnames]{beamer} 
\input{../theme/_TeXdefs}
\usepackage{listings}
%<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<%
% END Document package information
%>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>%

%=============================================================================%
% Begining: Title Page Material
%=============================================================================%
\begin{document}
	\title[Matrix Multiplication]{Matrix Multiplication}
	\author[]{\className}
	\institute[\className]{\departmentName}
	\date{} 

	\titlegraphic{\centering 
		$\vcenter{\hbox{\includegraphics[height=.31in,width=2.0in]{oregonLogo}}}$
	}

	\begin{frame}
		\maketitle
	\end{frame}
	
	%--- Next Frame ---%

	\begin{frame}{Definition}
		\begin{equation*}
			A =
			\begin{bmatrix}
				A_{11} & A_{12} & \ldots & A_{1p} \\
				A_{21} & A_{22} & \ldots & A_{2p} \\
				\vdots & \vdots & \ddots & \vdots \\
				A_{m1} & A_{m2} & \ldots & A_{mp}
			\end{bmatrix}, 
			B =
			\begin{bmatrix}
				B_{11} & B_{12} & \ldots & B_{1n} \\
				B_{21} & B_{22} & \ldots & B_{2n} \\
				\vdots & \vdots & \ddots & \vdots \\
				A_{p1} & B_{p2} & \ldots & B_{pn}
			\end{bmatrix}
		\end{equation*}
		\begin{equation*}
			C = A \times B = 
			\begin{bmatrix}
				C_{11} & C_{12} & \ldots & C_{1n} \\
				C_{21} & C_{22} & \ldots & C_{2n} \\
				\vdots & \vdots & \ddots & \vdots \\
				C_{m1} & C_{m2} & \ldots & C_{mn}
			\end{bmatrix}
		\end{equation*}
		\begin{equation*}
			C_{ij} = \sum_{k=1}^p{A_{ik}B_{kj}}
		\end{equation*}
	\end{frame}

	%--- Next Frame ---%

	\begin{frame}{Definition}
		\begin{center}
		\includegraphics[scale=0.5]{images/multip}
		\footnote{Picture from wikipedia}
		\end{center}
	\end{frame}

	%--- Next Frame ---%

	\defverbatim[colored]\lstnaive{%
	\begin{lstlisting}[tabsize=8,basicstyle=\ttfamily]
	for (i=0; i<M; i++) {
	    for (j=0; j<N; j++) {
		C[i][j] = 0;
		for (k=0; k<P; k++) {
		    C[i][j] += A[i][k] * B[k][j];
		}
	    }
	}
	\end{lstlisting}
	}

	\begin{frame}{Naive implementation}
		\lstnaive
	\end{frame}

	%--- Next Frame ---%
	\defverbatim[colored]\lsttmp{%
	\begin{lstlisting}[tabsize=8,basicstyle=\ttfamily]
	double tmp = 0.0;
	for (k=0; k<P; i++) {
	    tmp += A[i][k] * B[k][j];
	}
	C[i][j] = tmp;
	\end{lstlisting}
	}

	\begin{frame}{Warm up}
		\begin{itemize}
			\item A serial implementation is provided
			\item \underline{FIXME: need unified method to get sample code}
			\item Compile and run

			% 1. inner loop, use a temp variable instead of C[i][j] directly
			% 2. loop interchange: swith the 2nd and 3rd loop
			% 3. 1 and 2 are not compatible
			\item Discussion: What's the problem with this program?

			\item Fix it, try again
		\end{itemize}
	\end{frame}
	
	%--- Next Frame ---%
	
	\begin{frame}{OpenMP Quick Review}
		\begin{itemize}
			\item \#pragma omp parallel
			\item \#pragma omp for
			\item \#pragma omp parallel for
			\item int omp\_set\_num\_threads();
			\item int omp\_get\_num\_threads();
			\item int omp\_get\_thread\_num();
			\item double omp\_get\_wtime();
		\end{itemize}
	\end{frame}
	
	%--- Next Frame ---%
	
	\begin{frame}{Parallel Matrix Multiplication}
		\begin{itemize}
			\item Try to parallelize the serial implementation
			\item Compile and run
			\item Speed up?

			% cat /proc/cpuinfo, we get 2.33GHz, 8 cores
			\item What is the theoretical peak FLOPS of a single MIST node?

			\item Can you reach it?
		\end{itemize}
	\end{frame}
	
	%--- Next Frame ---%

	\begin{frame}{Want More?}
		\begin{itemize}
			\item Blocked (Tiled) Matrix Multiply
			\item Strassen's Algorithm
			\item BLAS / ATLAS
		\end{itemize}
	\end{frame}

\end{document}
%END ALL

